<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
    <title>英语默写练习</title>
    <link crossorigin="anonymous" href="https://lib.baomitu.com/twitter-bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://lib.baomitu.com/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script crossorigin="anonymous" src="https://lib.baomitu.com/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<style>
    .list-group-numbered>.list-group-item::before {
        color: #adb5bd;
        font-size: 1rem;
    }
</style>

<body class="p-4">
    <div class="container px-5">
        <h3 class="mb-3 text-center">英语默写练习</h3>
        <!-- 选项卡 -->
        <ul class="nav nav-pills nav-fill mb-3" id="modeTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active fs-5" id="en-tab" data-bs-toggle="tab" data-bs-target="#en" type="button" role="tab">英文<i class="bi bi-arrow-right px-3"></i>中文</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link fs-5" id="zh-tab" data-bs-toggle="tab" data-bs-target="#zh" type="button" role="tab">中文<i class="bi bi-arrow-right px-3"></i>英文</a>
            </li>
        </ul>
        <!-- 页面选择 -->
        <div class="mb-3">
            每页显示：
            <select id="pageSize" class="form-select w-auto d-inline">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
            </select>
            个单词
        </div>
        <!-- 月份选择下拉（动态生成） -->
        <div class="mb-3" id="monthContainer"></div>
        <!-- 单词列表 -->
        <ol class="list-group list-group-numbered list-group-flush fs-4" id="wordList"></ol>
        <!-- 按钮 -->
        <div class="mt-3 text-end">
            <button class="btn btn-primary me-2" id="showAnswerBtn">显示答案</button>
            <button class="btn btn-secondary me-2" id="prevPageBtn">上一页</button>
            <button class="btn btn-secondary" id="nextPageBtn">下一页</button>
        </div>
    </div>
    <script>
        let words = [];
        let currentPage = 0;
        let pageSize = parseInt(document.getElementById('pageSize').value);
        let answerShown = false;

        // 获取当前模式
        function getMode() {
            const activeTab = document.querySelector('#modeTabs .nav-link.active');
            return activeTab.id === 'en-tab' ? 'en' : 'zh';
        }

        // 渲染单词
        function renderPage() {
            const list = document.getElementById('wordList');
            list.innerHTML = '';
            pageSize = parseInt(document.getElementById('pageSize').value);
            const start = currentPage * pageSize;
            const pageWords = words.slice(start, start + pageSize);
            const mode = getMode();

            pageWords.forEach(word => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerHTML = `
                    <span class="px-3 lh-lg">${mode === 'en' ? word.en : word.zh}</span>
                    <span class="px-5 answer text-success lh-lg">${mode === 'en' ? word.zh : word.en}</span>
                `;
                list.appendChild(li);
            });

            if (!answerShown) hideAnswers();
        }

        // 显示/隐藏答案
        function toggleAnswer() {
            answerShown = !answerShown;
            document.querySelectorAll('.answer').forEach(el => {
                el.style.display = answerShown ? 'inline' : 'none';
            });
            document.getElementById('showAnswerBtn').textContent = answerShown ? '关闭答案' : '显示答案';
        }

        function hideAnswers() {
            document.querySelectorAll('.answer').forEach(el => el.style.display = 'none');
            answerShown = false;
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                renderPage();
            }
        }

        function nextPage() {
            if ((currentPage + 1) * pageSize < words.length) {
                currentPage++;
                renderPage();
            }
        }

        // 加载 YAML 文件
        async function loadWords(month) {
            try {
                const res = await fetch(`words/${month}.yaml`);
                const text = await res.text();
                words = jsyaml.load(text);
                currentPage = 0;
                answerShown = false;
                document.getElementById('showAnswerBtn').textContent = '显示答案';
                renderPage();
            } catch (err) {
                alert('加载单词失败，请检查 YAML 文件路径或格式');
                console.error(err);
            }
        }

        // 加载月份列表
        async function loadMonthList() {
            try {
                const res = await fetch('words/list.json');
                const files = await res.json();
                const months = files.map(f => f.replace('.yaml',''));
                const container = document.getElementById('monthContainer');

                const select = document.createElement('select');
                select.id = 'monthSelect';
                select.className = 'form-select w-auto d-inline';
                months.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m;
                    opt.textContent = m;
                    select.appendChild(opt);
                });
                container.appendChild(select);

                // 默认选中当前月份
                const today = new Date();
                const defaultMonth = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}`;
                select.value = months.includes(defaultMonth) ? defaultMonth : months[0];
                loadWords(select.value);

                select.addEventListener('change', e => loadWords(e.target.value));
            } catch(err) {
                alert('加载月份列表失败，请检查 words/list.json');
                console.error(err);
            }
        }

        // 事件绑定
        document.getElementById('showAnswerBtn').addEventListener('click', toggleAnswer);
        document.getElementById('nextPageBtn').addEventListener('click', nextPage);
        document.getElementById('prevPageBtn').addEventListener('click', prevPage);
        document.getElementById('pageSize').addEventListener('change', () => {
            currentPage = 0;
            renderPage();
        });
        document.querySelectorAll('#modeTabs .nav-link').forEach(tab => {
            tab.addEventListener('shown.bs.tab', renderPage);
        });

        // 初始化加载月份
        loadMonthList();
    </script>
</body>

</html>
