<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta charset="utf-8">
    <title>英语默写练习</title>
    <link crossorigin="anonymous" href="https://lib.baomitu.com/twitter-bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <link crossorigin="anonymous" href="https://lib.baomitu.com/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <script crossorigin="anonymous" src="https://lib.baomitu.com/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<style>
    .list-group-numbered>.list-group-item::before {
        color: #adb5bd;
        font-size: 1rem;
    }
</style>

<body class="p-4">
    <div class="container px-5">
        <h3 class="mb-3 text-center">英语默写练习</h3>
        <!-- 选项卡 -->
        <ul class="nav nav-pills nav-fill mb-3" id="modeTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active fs-5" id="en-tab" data-bs-toggle="tab" data-bs-target="#en" type="button" role="tab">英文<i class="bi bi-arrow-right px-3"></i>中文</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link fs-5" id="zh-tab" data-bs-toggle="tab" data-bs-target="#zh" type="button" role="tab">中文<i class="bi bi-arrow-right px-3"></i>英文</a>
            </li>
        </ul>

        <!-- 月份下拉菜单 (动态生成) -->
        <div class="mb-3" id="monthContainer"></div>

        <!-- 页面选择 -->
        <div class="mb-3">
            每页显示：
            <select id="pageSize" class="form-select w-auto d-inline">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
            </select>
            个单词
        </div>

        <!-- 单词列表 -->
        <ol class="list-group list-group-numbered list-group-flush fs-4" id="wordList"></ol>

        <!-- 按钮 -->
        <div class="mt-3 text-end">
            <button class="btn btn-primary me-2" id="showAnswerBtn">显示答案</button>
            <button class="btn btn-secondary me-2" id="prevPageBtn">上一页</button>
            <button class="btn btn-secondary" id="nextPageBtn">下一页</button>
        </div>
    </div>

    <script>
        let words = [];
        let currentPage = 0;
        let pageSize = parseInt(document.getElementById('pageSize').value);
        let answerShown = false;

        // 你的 YAML 文件列表，动态生成下拉菜单
        const months = ["2025-08", "2025-09"]; // 每个月对应一个 YAML 文件

        // 渲染月份下拉菜单
        const monthContainer = document.getElementById('monthContainer');
        const monthSelect = document.createElement('select');
        monthSelect.id = 'monthSelect';
        monthSelect.className = 'form-select w-auto d-inline mb-3';
        months.forEach(m => {
            const opt = document.createElement('option');
            opt.value = m;
            opt.textContent = m;
            monthSelect.appendChild(opt);
        });
        monthContainer.appendChild(monthSelect);

        // 获取当前模式（英文→中文 or 中文→英文）
        function getMode() {
            const activeTab = document.querySelector('#modeTabs .nav-link.active');
            return activeTab.id === 'en-tab' ? 'en' : 'zh';
        }

        // 渲染单词页面
        function renderPage() {
            const list = document.getElementById('wordList');
            list.innerHTML = '';
            pageSize = parseInt(document.getElementById('pageSize').value);
            const start = currentPage * pageSize;
            const pageWords = words.slice(start, start + pageSize);
            const mode = getMode();

            pageWords.forEach(word => {
                const li = document.createElement('li');
                li.className = 'list-group-item';
                li.innerHTML = `
                    <span class="px-3 lh-lg">${mode === 'en' ? word.en : word.zh}</span>
                    <span class="px-5 answer text-success lh-lg">${mode === 'en' ? word.zh : word.en}</span>
                `;
                list.appendChild(li);
            });

            if (!answerShown) hideAnswers();
        }

        // 显示/隐藏答案 & 切换按钮文字
        function toggleAnswer() {
            answerShown = !answerShown;
            document.querySelectorAll('.answer').forEach(el => {
                el.style.display = answerShown ? 'inline' : 'none';
            });
            document.getElementById('showAnswerBtn').textContent = answerShown ? '关闭答案' : '显示答案';
        }

        // 隐藏答案
        function hideAnswers() {
            document.querySelectorAll('.answer').forEach(el => el.style.display = 'none');
            answerShown = false;
        }

        // 上一页
        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                renderPage();
            }
        }

        // 下一页
        function nextPage() {
            if ((currentPage + 1) * pageSize < words.length) {
                currentPage++;
                renderPage();
            }
        }

        // 加载 YAML 文件
        async function loadWords(month) {
            const url = `words/${month}.yaml`;
            try {
                const res = await fetch(url);
                const text = await res.text();
                words = jsyaml.load(text); // words = [{en:'apple', zh:'苹果'}, ...]
                currentPage = 0;
                answerShown = false;
                document.getElementById('showAnswerBtn').textContent = '显示答案';
                renderPage();
            } catch (err) {
                alert('加载单词失败，请检查 YAML 文件路径或格式');
                console.error(err);
            }
        }

        // 事件绑定
        document.getElementById('showAnswerBtn').addEventListener('click', toggleAnswer);
        document.getElementById('nextPageBtn').addEventListener('click', nextPage);
        document.getElementById('prevPageBtn').addEventListener('click', prevPage);
        document.getElementById('pageSize').addEventListener('change', () => {
            currentPage = 0;
            renderPage();
        });
        document.querySelectorAll('#modeTabs .nav-link').forEach(tab => {
            tab.addEventListener('shown.bs.tab', () => renderPage());
        });
        monthSelect.addEventListener('change', e => loadWords(e.target.value));

        // 初始化加载第一个月份
        loadWords(months[0]);
    </script>
</body>

</html>
